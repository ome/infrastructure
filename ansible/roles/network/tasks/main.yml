---
# Setup network interfaces

- name: network | remove nics
  become: yes
  file:
    path: /etc/sysconfig/network-scripts/ifcfg-{{ item }}
    state: absent
  with_items: network_delete_ifaces | default ([])
  notify:
    - restart network

- name: network | Setup nics
  become: yes
  template:
    backup: yes
    src: etc-sysconfig-network-scripts-ifcfg.j2
    dest: /etc/sysconfig/network-scripts/ifcfg-{{ item.device }}
  with_items: network_ifaces
  notify:
    - restart network

- name: network | restart network if necessary before checking bonding
  meta: flush_handlers

- name: network | check bonding
  stat:
    path: /proc/net/bonding/{{ item.bondmaster }}
  with_items: network_ifaces
  when: "'bondmaster' in item"
  register: checkbonds

- name: network | check bonding active
  assert:
    that:
    - "item.stat.exists and not item.stat.isdir"
  with_items:
    - "{{ checkbonds.results }}"
