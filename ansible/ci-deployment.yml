---
# Playbook for deploying Jenkins CI nodes

- hosts: ci-jenkins-linux
  roles:
    - role: jenkinsslave
    - role: virtualenv
    - role: sudoers
    - role: versioncontrol-utils
    - role: system-monitor-agent

  vars:
    virtualenv_user: "{{ jenkinsuser }}"
    virtualenv_path: /home/{{ jenkinsuser }}/virtualenv
    virtualenv_site_packages: "yes"
    virtualenv_pip_rpm_dependencies:
    virtualenv_pip_dependencies:
    - scc
    - omego
    - genshi
    - yaclifw
    - PyYAML
    - Sphinx==1.2.3
    - epydoc
    - "django>=1.8,<1.9"

# Deploy OMERO build and runtime prerequisites
- hosts: ci-omero
  roles:
    - role: omero-build
    - role: omero-runtime
#    - role: omero-build-cpp
    - role: postgresql
      postgresql_server_listen: "'*'"
      postgresql_server_auth:
      - database: all
        user: omero
        address: 0.0.0.0/0
      postgresql_users_databases:
      - user: omero
        password: omero
        databases: [omero]
      postgresql_server_chown_datadir: True

# Deploy OMERO build and runtime prerequisites
- hosts: ci-omero-web
  roles:
    - role: omero-runtime
    - role: omero-web-runtime
    - role: nginx


# Deploy Documentation prerequisites
- hosts: ci-docs
  roles:
    - role: virtualenv
    - role: sphinx-build
    - role: ansible

  vars:
    virtualenv_user: "{{ jenkinsuser }}"
    virtualenv_path: /home/{{ jenkinsuser }}/virtualenv
    virtualenv_site_packages: "yes"
    virtualenv_pip_rpm_dependencies:
    virtualenv_pip_dependencies:
    - scc
    - omego
    - genshi
    - yaclifw
    - PyYAML
    - Sphinx==1.2.3
    - epydoc
    - Pygments>=1.2
    - "django>=1.8,<1.9"